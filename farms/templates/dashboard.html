{% extends "base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
  .card-title {
    font-weight: 600;
    color: #2e7d32;
  }
  .card {
    border: none;
    border-radius: 12px;
  }
  .btn-success {
    background-color: #2e7d32;
    border: none;
  }
  .btn-outline-success {
    border-color: #2e7d32;
    color: #2e7d32;
  }
  .btn-outline-success:hover {
    background-color: #2e7d32;
    color: white;
  }
</style>

<div class="text-center mb-4">
  <h2 class="fw-bold">Welcome, {{ username }} 👋</h2>
  <p class="text-muted">Cultivating Tomorrow, Organically 🌱</p>
</div>

<!-- Quick Stats -->
<div class="row g-4 mb-4">
  <div class="col-md-4">
    <div class="card shadow-sm">
      <div class="card-body text-center">
        <h5 class="card-title">🌱 My Farms</h5>
        <p>You have <strong>{{ farm_count }}</strong> farm(s) registered.</p>
        <a href="{% url 'farm_register' %}" class="btn btn-success btn-sm">Add Farm</a>
        <a href="{% url 'view_farms' %}" class="btn btn-outline-success btn-sm">View Farms</a>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card shadow-sm">
      <div class="card-body text-center">
        <h5 class="card-title">🏪 Nearby Shops</h5>
        <p>{{ nearby_shops|length }} shop(s) found within 10 km.</p>
        <a href="{% url 'nearby_shops' %}" class="btn btn-success btn-sm">Find Shops</a>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card shadow-sm">
      <div class="card-body text-center">
        <h5 class="card-title">📚 Resources</h5>
        <p>Featured Tip: <em>{{ featured_tip }}</em></p>
        <a href="{% url 'resources' %}" class="btn btn-outline-success btn-sm">Explore Resources</a>
      </div>
    </div>
  </div>
</div>

<!-- Recent Activity -->
<div class="row mb-4">
  <div class="col">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">🕒 Recent Activity</h5>
        {% if farm_count > 0 %}
          <p>Last farm added: <strong>{{ farms.last.name }}</strong></p>
        {% else %}
          <p>No farms added yet.</p>
        {% endif %}
        {% if nearby_shops %}
          <p>Last shop searched: <strong>{{ nearby_shops.0.name }}</strong></p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Map Snapshot -->
{% if farm_count > 0 %}
<div class="row mb-4">
  <div class="col">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">🗺️ Your Farm Map</h5>
        <div id="map" style="height:300px; border-radius:12px;"></div>
      </div>
    </div>
  </div>
</div>

<script>
  var map = L.map('map').setView([{{ farms.first.latitude|default:"0" }}, {{ farms.first.longitude|default:"0" }}], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  {% for farm in farms %}
    L.marker([{{ farm.latitude|default:"0" }}, {{ farm.longitude|default:"0" }}])
      .addTo(map)
      .bindPopup("🌱 {{ farm.name }}");
  {% endfor %}
</script>
{% endif %}

<!-- Notifications -->
<div class="row mb-4">
  <div class="col">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">🔔 Notifications</h5>
        <ul class="list-unstyled">
          <li>✅ Profile complete</li>
          <li>📍 New shop opened near Green Valley Farm</li>
          <li>📅 No upcoming deadlines</li>
        </ul>
      </div>
    </div>
  </div>
</div>

{% endblock %}
